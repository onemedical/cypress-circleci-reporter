"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("xmlbuilder2"),s=require("mocha"),i=e(s),r=e(require("mocha/lib/stats-collector")),n=e(require("fs")),u=e(require("path")),o=e(require("crypto")),l=e(require("strip-ansi"));const{EVENT_RUN_END:a,EVENT_TEST_FAIL:c,EVENT_TEST_PASS:p,EVENT_SUITE_BEGIN:d}=s.Runner.constants,f=/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007f-\u0084\u0086-\u009f\uD800-\uDFFF\uFDD0-\uFDFF\uFFFF\uC008]/g;function m(e){return e?e.replace(f,""):e}function h(e){let{parent:t}=e;const s=[];for(;t;)t.title&&s.unshift(t.title),t=t.parent;return s.join(".")}class g extends i.reporters.Base{constructor(e,s){var i,f,g;super(e,s),this.file="",this.getTestcaseAttributes=e=>({name:l(e.title),file:this.file,time:void 0===e.duration?0:(e.duration/1e3).toFixed(4),classname:l(h(e)),line_number:JSON.parse(e.inspect()).invocationDetails.line}),r(e);const F=null==s?void 0:null==(i=s.reporterOptions)?void 0:i.project,v=(null==s?void 0:null==(f=s.reporterOptions)?void 0:f.resultsDir)||"./test_results/cypress",S=(null==s?void 0:null==(g=s.reporterOptions)?void 0:g.resultFileName)||"cypress-[hash]";if(S.indexOf("[hash]")<0)throw new Error("resultFileName must contain '[hash]'");const E=u.join(v,`${S}.xml`),y=t.create({version:"1.0",encoding:"UTF-8"}).ele("testsuite",{name:"cypress",timestamp:(new Date).toISOString().slice(0,-5)});e.on(d,e=>{e.file&&(this.file=u.join(F||"",e.file))}),e.on(p,e=>{y.ele("testcase",this.getTestcaseAttributes(e))}),e.on(c,(e,t)=>{let s="";t.message&&"function"==typeof t.message.toString?s=String(t.message):"function"==typeof t.inspect&&(s=String(t.inspect()));const i=t.stack||s;y.ele("testcase",this.getTestcaseAttributes(e)).ele("failure",{message:m(s)||"",type:t.name||""}).ele({$:m(i)})}),e.on(a,()=>{var t,s,i,r;y.att("time",(((null==(t=e.stats)?void 0:t.duration)||0)/1e3).toFixed(4)),y.att("tests",String((null==(s=e.stats)?void 0:s.tests)||0)),y.att("failures",String((null==(i=e.stats)?void 0:i.failures)||0)),y.att("skipped",String((null==(r=e.stats)?void 0:r.pending)||0));const l=y.end({prettyPrint:!0}).toString(),a=E.replace("[hash]",o.createHash("md5").update(l).digest("hex")),c=u.dirname(a);n.existsSync(c)||n.mkdirSync(c,{recursive:!0}),n.writeFileSync(a,l,"utf-8")})}}module.exports=g,exports.default=g;
//# sourceMappingURL=cypress-circleci-reporter.cjs.production.min.js.map
